---
title: Js单例模式
date: 2024-05-03 21:27:02
tags: [JavaScript，设计模式]
category: Developer
---

### 1. 单例模式

在面向对象的程序设计中， 单例模式是最简单的设计模式，这种类型的设计模式属于创建型模型，所谓单例。

就是整个程序有且仅有一个实例。该类只负责创建自己的对象，同时确保只有一个实例。

#### 1.1 为什么需要单例模式

单例模式是一个对象创建模式， 用于生产一个对象的实例，它可以确保系统中一个类只有一个实例，它用两个好处：

1. 对于频繁调用的对象，可以省略创建对象所花费的时间，这对那些重量级的对象来说，是非常可观的一笔系统开销。
2. 在内存中一个实例对象， 节省了内存空间， 避免了重复得创建和销毁对象，可以提高系统的性能， 避免对多重复资源的重复占用， 可以全局访问。

#### 1.2 起步

通常来说我们每次通过class类new 声明的实例都是一个全新的对象，所以我们多次重复new一个类生成的实例对象都是不同的对象， 较大了提高内存的占用。

```js
 class Person{
     constructor(){
         this.name = '张三'
     }
 }
 let one = new Person(),
     two = new Person();
 console.log(one === two);// false
```

上面的代码我们通过Person类new了两个实例， 虽然他们看上去长得一样，但是他们是两个不一样的对象,他们在内存指向了两个不同的地址, 所以打印的是fasle。

此时如果我们如果想要one和two全等， 就需要用到单例模式。 单例模式不管我们用new调用了Person多少次， 所返回的实例对象都是第一次通过new实例调用的对象。

#### 1.3 思路

方法一: 使用立即执行函数形成闭包

利用函数闭包,定义一个变量，保存第一个实例对象的结果。如果再次通过new调用时，此时就可以判断这个变量是否存在。如果存在就直接返回这个对象。

```js
let Single = (function (){
    // 利用闭包记录类第一次实例化的对象
    let instnce = null;
    return class{
        constructor(){
            //判断instnce是否为null,即为第一次通过new调用,如果是就将实例对象this赋值给instnce
            if(!instnce) instnce = this;
             // 当instnce有值时,此时我们直接返回这个对象
              return instnce
        }
    }
})()
let one = new Person(),
     two = new Person();
 console.log(one === two);// true
```

方法二: 利用类的静态属性

思路: 和第一种方法差不多，只不过我们原来通过了类的静态属性用来保存实例对象，如果没有这个变量就用类的静态属性来保存这个对象,，如果有这个变量就直接返回这个对象。

```js
 class Fn {
     constructor(){
         // 判断类是否有这个静态属性,如果没有就设置,如果有就直接返回这个类的静态属性
         if(!(Fn.instance)){
             Fn.instance = this;
         }else{
             return Fn.instance
         }
     }
 }
```

我们发现通过类的静态属性写起来更加简洁，也更符合语义化，较大了提高了代码的可读性，所以我们通常推荐使用第二种方法。
